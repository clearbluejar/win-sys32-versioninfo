name: Generate Version Info

on:
  workflow_dispatch:
  
jobs:
  generate_versioninfo:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3

    - name: Generate System32 VersionInfo
      run: |
        $ver = [System.Environment]::OSVersion.Version -join '.'
        $path = "${ver}-versioninfo-system32.json"
        Get-ChildItem "C:\Windows\system32\*" -Include "*.dll","*.exe" | select  Name,VersionInfo |ConvertTo-Json  -depth 100 | Out-File $path
        

    # Upload Artifacts 
    - name: Upload VersionInfo Json
      uses: actions/upload-artifact@v3
      with:
        name: version-info-json
        path: ./*.json
